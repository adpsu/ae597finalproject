import pandas as pd

# Sample DataFrame
df = pd.DataFrame({
    'year': [2020, 2020, 2020, 2021, 2021, 2021, 2021],
    'Best Match Experian Sales': [100, 150, 100, 200, 250, 200, 300],
    'MSRP': ["NA", 50000, "NA", 30000, "NA", 45000, "NA"],
    'experian_sales': [10, 15, 10, 20, 25, 20, 30]
})

# Create an empty DataFrame to store the results
result_df = pd.DataFrame()

# Loop through each unique year in the dataset
for year in df['year'].unique():
    # Filter rows for the current year
    df_year = df[df['year'] == year]

    # Identify rows where "MSRP" is "NA"
    na_msrp_rows = df_year[df_year['MSRP'] == "NA"]

    # Find unique "Best Match Experian Sales" and "experian_sales" counts
    unique_best_match_sales = na_msrp_rows['Best Match Experian Sales'].value_counts() == 1
    unique_experian_sales = na_msrp_rows['experian_sales'].value_counts() == 1

    # Get the indices of rows with unique "Best Match Experian Sales" and "experian_sales"
    unique_indices = na_msrp_rows[
        na_msrp_rows['Best Match Experian Sales'].isin(unique_best_match_sales[unique_best_match_sales].index) &
        na_msrp_rows['experian_sales'].isin(unique_experian_sales[unique_experian_sales].index)
    ].index

    # Append the unique rows to the result DataFrame
    result_df = pd.concat([result_df, df.loc[unique_indices]])

print("Rows for all years where 'MSRP' is 'NA' and 'Best Match Experian Sales' and 'experian_sales' are unique in that year:")
print(result_df)

